  <div class="container">
      <div id="searchbox">
        <input id="search" type="text" placeholder="San Francisco">
        <input id="search2" type="text" placeholder="Packers">
        <input id="submit" type="submit" value="Scheme">
      </div>
  </div>
  <div class="container">
    <div class="row-fluid" id="main-container">
      <div id="events-container" class="span7">
      </div>
      <div id="schema-container" class="span7">
        <h4> 345235442 People Scheming. How about you?</h4>
        <div id="schemes">
        </div>
      </div>

    </div>

    <!-- if current_user div -->
    <% if @current_user %>
      <div id="your-upcomming-schemes" class="span2 offset1">
        <ul id="user-schemes">
          <!-- start schemes -->
          <% @current_user.schemes do |scheme| %>
            <li class="scheme">
              <img class="photo" style="background-image:<%= scheme.image %>" />
              <div class="versus">
                <span class="team-first">
                  <%= scheme.event.team1 %>
                </span>
                <span>
                  <%= scheme.event.team2 %>
                </span>
              </div>
              <div class="scheme-type" <%= toHTMLDataAttr(scheme.type) %>>
              </div>
            </li>
          <% end %>
          <!-- end schemes -->
        </div>
      </div>
    <% end %> 
    <!-- end if current_user div -->
  </div>
  <div class="modal clearfix" id="team-select">

  </div>

<script type="text/template"  id="search-results-template">
  <h4> [[= count ]] Results</h4>
  <div id="events">
  </div>
</script>

<script type="text/template" id="modal-popup">
  <h3 class="modal-header">Pick your Team</h3>
  <div class="modal-body">
    <a href="/events/[[= id ]]?team=[[= performers[0].name  ]]"><div id="team1">[[= performers[0].name ]]</div></a>
    <div class="versus-image"><img src="[[= images[0].url ]]" /></div>
    <a href="/events/[[= id ]]?team=[[= performers[1].name  ]]"><div id="team2">[[= performers[1].name ]]</div></a>
  </div>
</script>

<script>
  $(document).ready(function(){
    var search_template = _.template($("#search-results-template").html());
    var team_select_template = _.template($("#modal-popup").html());
    function changeDomOnSearch(events){
      $("#schema-container").remove();
      var matches = _.filter(events, function(event){
                      return event.performers.length == 2;
                    });
      $("#events-container").html("").show();
      $("#events-container").append(
        search_template({ count: matches.length })
      );
      _.each(matches, function(event){
        var ev = $("<div class='event'>"+event.name+"</div>");
        console.log(event.performers);
        ev.click(function(){
          $.ajax({
              type: 'POST',
              url: '/events',
              data: {
                event: {
                  stubhub_eventId: event.id,
                  name : event.name,
                  image_url: event.images[0].url,
                  team_1: event.performers[0].name,
                  team_2: event.performers[1].name
                }
              },
          });

          $("#team-select").html(team_select_template(event)).modal();
        });
        $("#events").append(ev);
      });
    }

    function bindings(){
      $("#submit").click(function(e){
        console.log("click");
        $(".everything").remove();
        search( $("#search").val(), $("#search2").val(), changeDomOnSearch );
        e.preventDefault();
        return false;
      });
    }
    $(".box").on("")
    bindings();
  });
</script>





